<html>
  <head>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
  </head>
  <body>
    <a-scene physics="gravity: 0 -9.8 0">
      
      <!-- Lighting -->
      <a-entity light="type: ambient; intensity: 1"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="0 5 5"></a-entity>

      <!-- Player (camera rig + collisions + movement) -->
      <a-entity id="player" position="0 1.6 8" 
                movement-controls="fly: false; speed: 0.05"
                kinematic-body>
        <a-camera wasd-controls="acceleration: 10; fly: false; enableKeyboard: true"></a-camera>
      </a-entity>

      <!-- Beginning straight path -->
      <a-plane static-body position="0 0 -2" rotation="-90 0 0" width="2" height="8" 
               material="src: #path; repeat: 4 16"></a-plane>

      <!-- Fork junction -->
      <a-plane static-body position="0 0 -8" rotation="-90 0 0" width="6" height="2" 
               material="src: #path; repeat: 12 4"></a-plane>

      <!-- Branches -->
      <a-plane id="branch-left" static-body position="-2 0 -14" rotation="-90 0 0" width="2" height="12" 
               material="src: #path; repeat: 4 24"></a-plane>

      <a-plane id="branch-middle" static-body position="0 0 -14" rotation="-90 0 0" width="2" height="12" 
               material="src: #path; repeat: 4 24"></a-plane>

      <a-plane id="branch-right" static-body position="2 0 -14" rotation="-90 0 0" width="2" height="12" 
               material="src: #path; repeat: 4 24"></a-plane>

      <!-- Reconnection horizontal -->
      <a-plane static-body position="0 0 -20" rotation="-90 0 0" width="6" height="2" 
               material="src: #path; repeat: 12 4"></a-plane>

      <!-- Ending straight path -->
      <a-plane static-body position="0 0 -26" rotation="-90 0 0" width="2" height="8" 
               material="src: #path; repeat: 4 16"></a-plane>

      <!-- Choice boxes (only at fork point) -->
      <a-box id="choice-left" position="-2 1 -8" depth="0.5" height="0.5" width="0.5" color="red"></a-box>
      <a-box id="choice-middle" position="0 1 -8" depth="0.5" height="0.5" width="0.5" color="green"></a-box>
      <a-box id="choice-right" position="2 1 -8" depth="0.5" height="0.5" width="0.5" color="blue"></a-box>

      <!-- Ground for collisions -->
      <a-plane static-body position="0 -0.01 0" rotation="-90 0 0" width="50" height="50" color="#5c8a3e"></a-plane>

      <!-- Path texture -->
      <a-assets>
        <img id="path" src="https://i.imgur.com/uyP2H9V.jpg">
      </a-assets>

      <script>
        // Handle choices
        const player = document.querySelector("#player");
        const choices = {
          left: document.querySelector("#choice-left"),
          middle: document.querySelector("#choice-middle"),
          right: document.querySelector("#choice-right"),
        };

        function blockBacktracking() {
          // Place an invisible wall behind the fork after choosing
          const wall = document.createElement("a-box");
          wall.setAttribute("position", "0 1 -7");
          wall.setAttribute("width", "6");
          wall.setAttribute("height", "3");
          wall.setAttribute("depth", "0.5");
          wall.setAttribute("static-body", "");
          wall.setAttribute("visible", "false");
          document.querySelector("a-scene").appendChild(wall);
        }

        Object.keys(choices).forEach(key => {
          choices[key].addEventListener("click", () => {
            console.log("Chose:", key);
            blockBacktracking();
            // Remove other boxes so only one choice is made
            Object.keys(choices).forEach(k => {
              if (k !== key) choices[k].remove();
            });
          });
        });
      </script>

    </a-scene>
  </body>
</html>


