<html>
<head>
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>

  <style>
    a-scene { width: 100%; height: 80vh; }
  </style>
</head>
<body>
  <a-scene cursor="rayOrigin: mouse" background="color: #87ceeb">

    <!-- Camera -->
    <a-entity position="-73 2 -297">
      <a-camera wasd-controls look-controls></a-camera>
    </a-entity>

    <!-- Assets -->
    <a-assets>
      <a-asset-item id="pathModel" src="assets/PATH.glb"></a-asset-item>
      <a-asset-item id="treeModel" src="assets/TREE.glb"></a-asset-item>
      <a-asset-item id="grassModel" src="assets/GRASS.glb"></a-asset-item>
    </a-assets> 

    <!-- Ground -->
    <a-plane src="assets/Ground024_8K-JPG_Color.jpg"
             normal-map="src: url(assets/Ground024_8K-JPG_NormalDX.jpg)"
             roughness-map="src: url(assets/Ground024_8K-JPG_Roughness.jpg)"
             displacement-map="src: url(assets/Ground024_8K-JPG_Displacement.jpg)"
             rotation="-90 0 0"
             width="40" height="40"
             repeat="40 40"
             material="roughness: 1;"
             position="-73.11485 -14.62706 -297.28662"
             scale="20 20 20">
    </a-plane>

    <!-- GLB scene -->
    <a-entity gltf-model="#pathModel" 
              scale="10 10 10" 
              position="0 1 0">
    </a-entity>

    <!-- Containers for imported grass & trees -->
    <a-entity id="grass-container"></a-entity>
    <a-entity id="tree-container"></a-entity>

    <!-- Lights -->
    <a-entity light="type: directional; intensity: 1" position="5 10 5"></a-entity>
    <a-entity light="type: ambient; intensity: 0.5"></a-entity>

    <!-- Spawn trees & grass -->
    <script>
      const grassContainer = document.querySelector('#grass-container');
      const treeContainer = document.querySelector('#tree-container');

      const centerX = -73.11485;   // ground/GLB center
      const centerZ = -297.28662;
      const groundRadius = 40;

      const forbiddenZones = [
        {x: 0, z: 0, r: 15},        // Path & existing trees
        {x: -7.3989, z: 0.04509, r: 10}, // Castle
        {x: -5.1287, z: -0.12678, r: 10}, // Path to castle
      ];

      function isFree(x, z) {
        return !forbiddenZones.some(zone => {
          const dx = x - zone.x;
          const dz = z - zone.z;
          return Math.sqrt(dx*dx + dz*dz) < zone.r;
        });
      }

      // --- Spawn grass ---
      const grassCount = 200;
      for (let i = 0; i < grassCount; i++) {
        const angle = Math.random() * Math.PI * 2;
        const distance = Math.random() * groundRadius;
        const x = centerX + Math.cos(angle) * distance;
        const z = centerZ + Math.sin(angle) * distance;

        const grass = document.createElement('a-entity');
        grass.setAttribute('gltf-model', '#grassModel');
        grass.setAttribute('scale', '1 1 1');
        grass.setAttribute('position', `${x} 0 ${z}`);
        grass.setAttribute('rotation', `0 ${Math.random()*360} 0`);

        grassContainer.appendChild(grass);
      }

      // --- Spawn trees ---
      const treeCount = 30;
      for (let i = 0; i < treeCount; i++) {
        let x, z, attempts = 0;
        do {
          const angle = Math.random() * Math.PI * 2;
          const distance = Math.random() * groundRadius;
          x = centerX + Math.cos(angle) * distance;
          z = centerZ + Math.sin(angle) * distance;
          attempts++;
        } while (!isFree(x, z) && attempts < 50);

        if (attempts < 50) {
          const tree = document.createElement('a-entity');
          tree.setAttribute('gltf-model', '#treeModel');
          tree.setAttribute('scale', '2 2 2');  // adjust to fit your GLB scene
          tree.setAttribute('position', `${x} 0 ${z}`);
          tree.setAttribute('rotation', `0 ${Math.random()*360} 0`);

          treeContainer.appendChild(tree);
        }
      }
    </script>

  </a-scene>
</body>
</html>
