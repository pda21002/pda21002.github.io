<html>
<head>
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
  
  <style>
    a-scene { width: 100%; height: 80vh; }
  </style>
</head>
<body>
  <a-scene cursor="rayOrigin: mouse" background="color: #87ceeb">

    <!-- Camera -->
    <a-entity position="5 15 100">
      <a-camera wasd-controls look-controls></a-camera>
    </a-entity>

    <!-- Assets -->
    <a-assets>
      <a-asset-item id="pathModel" src="assets/PATH.glb"></a-asset-item>

      <a-asset-item id="tree1" src="assets/cypress_tree.glb"></a-asset-item>
      <a-asset-item id="grass1" src="assets/fern_grass_01.glb"></a-asset-item>
      <a-asset-item id="grass2" src="assets/garden_flower_-_vegetation.glb"></a-asset-item>
      <a-asset-item id="grass3" src="assets/grass_04.glb"></a-asset-item>
      <a-asset-item id="grass4" src="assets/grass_vegitation_mix.glb"></a-asset-item>
      <a-asset-item id="tree2" src="assets/linden_tree.glb"></a-asset-item>
      <a-asset-item id="grass5" src="assets/realistics_grass_10.glb"></a-asset-item>
      <a-asset-item id="grass6" src="assets/thistle.glb"></a-asset-item>
      <a-asset-item id="tree3" src="assets/tree2.glb"></a-asset-item>
      <a-asset-item id="grass7" src="assets/white_flower.glb"></a-asset-item>
    </a-assets> 

    <!-- Ground -->
    <a-plane src="assets/Ground024_8K-JPG_Color.jpg"
             rotation="-90 0 0"
             width="40" height="40"
             repeat="40 40"
             material="roughness: 1;"
             position="-73.11485 -14.62706 -297.28662"
             scale="20 20 20">
    </a-plane>

    <!-- GLB scene -->
    <a-entity id="pathEntity" gltf-model="#pathModel" scale="10 10 10" position="0 -19.842 0"></a-entity>

    <!-- Containers -->
    <a-entity id="grass-container"></a-entity>
    <a-entity id="tree-container"></a-entity>

    <!-- Lights -->
    <a-entity light="type: directional; intensity: 1" position="5 10 5"></a-entity>
    <a-entity light="type: ambient; intensity: 0.5"></a-entity>


<script>
const grassContainer = document.querySelector('#grass-container');
const treeContainer = document.querySelector('#tree-container');

// Center of your ground / scene
const groundY = -14.6;   // ground level
const groundRadius = 400; // how far to scatter

// Forbidden zones
const forbiddenZones = []; // start empty, will add dynamically

// Tree and grass models with baseScale
const treeModels = [
  { model: '#tree1', baseScale: 40 },
  { model: '#tree2', baseScale: 15 },
  { model: '#tree3', baseScale: 12 }
];

const grassModels = [
  { model: '#grass1', baseScale: 3 },
  { model: '#grass2', baseScale: 4 },
  { model: '#grass3', baseScale: 6 },
  { model: '#grass4', baseScale: 10 },
  { model: '#grass5', baseScale: 0.4 },
  { model: '#grass6', baseScale: 0.1 },
  { model: '#grass7', baseScale: 0.3 }
];

// Function to check if position is free
function isFree(x, z) {
  return !forbiddenZones.some(zone => {
    const dx = x - zone.x;
    const dz = z - zone.z;
    return Math.sqrt(dx*dx + dz*dz) < zone.r;
  });
}

// Function to spawn grass
function spawnGrass() {
  const grassCount = 400;
  for (let i = 0; i < grassCount; i++) {
    const angle = Math.random() * Math.PI * 2;
    const distance = Math.random() * groundRadius;
    const x = angleCos(angle, distance);
    const z = angleSin(angle, distance);

    if (isFree(x, z)) {
      const choice = grassModels[Math.floor(Math.random() * grassModels.length)];
      const variation = 0.5 + Math.random() * 0.3; // size variation
      const scale = choice.baseScale * variation;

      const grass = document.createElement('a-entity');
      grass.setAttribute('gltf-model', choice.model);
      grass.setAttribute('scale', `${scale} ${scale} ${scale}`);
      grass.setAttribute('position', `${x} ${groundY} ${z}`);
      grass.setAttribute('rotation', `0 ${Math.random()*360} 0`);
      grassContainer.appendChild(grass);
    }
  }
}

// Function to spawn trees
function spawnTrees() {
  const treeCount = 100;
  for (let i = 0; i < treeCount; i++) {
    let x, z, attempts = 0;
    do {
      const angle = Math.random() * Math.PI * 2;
      const distance = Math.random() * groundRadius;
      x = angleCos(angle, distance);
      z = angleSin(angle, distance);
      attempts++;
    } while (!isFree(x, z) && attempts < 50);

    if (attempts < 50) {
      const choice = treeModels[Math.floor(Math.random() * treeModels.length)];
      const variation = 0.5 + Math.random() * 0.3;
      const scale = choice.baseScale * variation;

      const tree = document.createElement('a-entity');
      tree.setAttribute('gltf-model', choice.model);
      tree.setAttribute('scale', `${scale} ${scale} ${scale}`);
      tree.setAttribute('position', `${x} ${groundY} ${z}`);
      tree.setAttribute('rotation', `0 ${Math.random()*360} 0`);
      treeContainer.appendChild(tree);
    }
  }
}

// Wait for path model to load, then compute forbidden zone
document.querySelector('[gltf-model="#pathModel"]').addEventListener('model-loaded', (e) => {
  const model = e.detail.model;
  const box = new THREE.Box3().setFromObject(model);

  // Center of the model
  const centerX = (box.min.x + box.max.x) / 2;
  const centerZ = (box.min.z + box.max.z) / 2;

  // Approximate radius (half the diagonal)
  const size = new THREE.Vector3();
  box.getSize(size);
  const radius = Math.sqrt(size.x*size.x + size.z*size.z)/2;

  forbiddenZones.push({ x: centerX, z: centerZ, r: radius + 5 }); // +5 buffer

  // Now spawn grass and trees
  spawnGrass();
  spawnTrees();
});

// Simple helpers
function angleCos(angle, distance) { return Math.cos(angle) * distance; }
function angleSin(angle, distance) { return Math.sin(angle) * distance; }
</script>



  </a-scene>
</body>
</html>

